# Интеграции

| Поле | Значение |
| --- | --- |
| Цель | Задокументировать внешние сервисы, используемые приложением |
| Аудитория | Разработчики, AI агент |
| Ответственный | Команда разработки |
| Последнее обновление | 2025-12-23 |
| Связанные документы | [Архитектура](../architecture/README.md), [Обзор данных](../data/README.md) |
| Ключевые классы | `ApiClient`, `TranslationRepository`, `MistralDictionarySearchProvider`, `GeminiDictionarySearchProvider`, `ImageRepository` |

## Обзор

Приложение подключается к нескольким внешним сервисам: Яндекс.Словарь для перевода, Mistral LLM для генерации расширенных словарных данных, Unsplash для изображений-подсказок и Gemini (через Firebase AI) как альтернативный источник словарей. Все HTTP-клиенты создаются в `ApiClient`, который использует Retrofit и общий `OkHttpClient` с логированием. Ключи пока зашиты в код — при подготовке к релизу их следует вынести в защищённое хранилище.

## Яндекс.Словарь

- **Назначение**: получение базовых переводов и примеров по запросу пользователя.
- **Ключевые классы**: `TranslationRepository`, `YandexDictionaryApi`.
- **Endpoint**: `GET https://dictionary.yandex.net/api/v1/dicservice.json/lookup`.
- **Параметры**: `text` — исходное слово, `lang` — пара языков (`en-ru`, `ru-en`), `key` — API-ключ.
- **Использование**: `TranslationRepository.getTranslations` возвращает список переводов; в UI применяется как первичный источник при создании карточки.
- **Ошибки**: любые исключения глушатся и приводят к пустому результату; стоит логировать критичные ошибки при продакшен-настройке.

## Mistral LLM

- **Назначение**: генерация расширенного словарного блока (формы слова, примеры, производные, теги сложности).
- **Ключевые классы**: `MistralDictionarySearchProvider`, `MistralApi`.
- **Endpoint**: `POST https://api.mistral.ai/v1/chat/completions` с моделью, заданной в `MistralDictionarySearchProvider`.
- **Запрос**: формируется список сообщений (`system` + `user`) в `MistralRequest`; ответы парсятся в структуру словаря, ошибки протоколируются через `Log`.
- **Fallback**: при неудаче используется `fallbackProvider` (обычно поиск по Яндексу) или возвращается пустой список.
- **Особенности**: ожидается JSON; код содержит санитаризацию Markdown-обёрток и повторный разбор при ошибках парсинга.

## Поиск изображений (Unsplash)

- **Назначение**: подбор иллюстрации-подсказки для карточки.
- **Ключевые классы**: `ImageRepository`, `UnsplashApi`, `ImagePickerDialog`.
- **Endpoint**: `GET https://api.unsplash.com/search/photos`.
- **Параметры**: `query` — поисковая фраза, `client_id` передаётся через `Authorization` (`apiKey` в `ImageRepository`).
- **Использование**: `ImageRepository.searchImages` возвращает список URL в качестве подсказок; загрузка выполняется через Glide (`downloadToFile`).
- **Ограничения**: соблюдать лимиты API и указывать корректные аттрибуции в UI (актуализировать при выводе изображений).

## Gemini через Firebase AI

- **Назначение**: альтернативный генератор словарей с поддержкой структурированных ответов.
- **Ключевые классы**: `GeminiDictionarySearchProvider`.
- **Инициализация**: `Firebase.ai(GenerativeBackend.googleAI())` создаёт `generativeModel` c именем `gemini-1.5-flash` (уточнить при конфигурации) и схемой ответа (`Schema`).
- **Запрос**: `model.generateContent` принимает промпт; конфигурация задаёт температуру, ожидаемый MIME (`application/json`) и schema validation.
- **Fallback**: при ошибках обращения к Gemini используется `fallbackProvider` (например, Яндекс).
- **Требования**: необходима настройка Firebase (файл `google-services.json`, включённые Firebase AI, настроенные квоты и ключ сервисного аккаунта).

## Что менять при доработке

- Перенеси API-ключи в безопасное хранилище (BuildConfig, EncryptedSharedPreferences или backend) и обнови документацию по настройке окружения.
- При добавлении нового внешнего сервиса создавай отдельный подраздел: цель, классы, схема запроса, обработка ошибок, фолбэки.
- Обновляй `ApiClient`, чтобы избежать дублирования настроек `OkHttpClient`; документируй базовый URL и заголовки.
- Перед релизом уточни требования лицензий (Unsplash, Mistral, Google) и отрази ограничения в UI/документации.

