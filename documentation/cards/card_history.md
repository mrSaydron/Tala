# История ответов

| Поле | Значение                                   |
| --- |--------------------------------------------|
| Цель | Описать модель данных для хранения истории качества ответов пользователя |
| Аудитория | Разработчики, AI агент                     |
| Ответственный | Команда разработки                         |
| Последнее обновление | 2025-12-25                                 |
| Связанные документы | [ER-диаграмма](../data/er_diagram.puml) |
| Ключевые классы | `CardHistory`, `CardHistoryDao`, `CardHistoryRepository`, `CardHistoryViewModel`, `LessonCardService` |

## Описание

В таблице `card_history` хранится качество ответов пользователя. Каждая запись связана с уроком, который проходил пользователь, со словарным словом, а так же проставляется дата ответа.
Качество ответа может быть числом от 0 до 5 включительно, значение которого соответствует ответу по SM-2.
История может использоваться для статистики, а так же для выбора типа карточек доступных пользователю для обучения.

## Запись истории

Каждое прохождение карточки фиксируется в `LessonCardService.answerResult`. Для типов `TRANSLATE`, `REVERSE_TRANSLATE` и `ENTER_WORD` сохраняется одна запись с качеством, которое выбрал пользователь. Для `TRANSLATION_COMPARISON` создаются отдельные записи по каждому слову: корректные сопоставления получают качество `5`, ошибки — `0`.

Дата (`date`) хранится в миллисекундах с начала эпохи и вычисляется тем же `timeProvider`, который используется сервисом для планирования повторений.

## Что менять при доработке

- При изменении структуры таблицы `card_history` синхронизируй модель Room (`CardHistory`) и ER-диаграмму.
- Изменяя логику ответов в `LessonCardService`, убедись, что история продолжает корректно сохраняться для всех типов карточек.
