# Архитектура приложения

| Поле | Значение |
| --- | --- |
| Цель | Зафиксировать ключевые архитектурные решения и слои приложения |
| Аудитория | Разработчики, AI агент |
| Ответственный | Команда разработки |
| Последнее обновление | 2025-12-23 |
| Связанные документы | [Типы карточек](../cards/card_types.md), [Прогресс карточек](../cards/card_progress.md) |

## Общий обзор

- Приложение реализовано по схеме single activity: `MainActivity` управляет навигацией между фрагментами через `FragmentManager`.
- UI строится на ViewBinding; состояние экрана хранится во `ViewModel`, а фрагменты выступают как тонкие контроллеры.
- Для хранения данных используется Room (`TalaDatabase`) с сущностями `Card`, `CardCollection`, `LessonProgress`, `Dictionary` и вспомогательными таблицами.
- Сетевой слой реализован на Retrofit-клиентах (`ApiClient`) для Yandex Dictionary, Unsplash и Mistral; вызовы выполняются из репозиториев с корутинами.

## Слоистая структура

- **UI слой**: `MainActivity` и фрагменты из `fragment/`. Отвечают за отображение, подписаны на `ViewModel`.
- **ViewModel слой**: управляет состоянием, координирует работу репозиториев, содержит бизнес-логику планирования повторений (`CardViewModel`).
- **Repository слой**: инкапсулирует доступ к данным (Room и сети), выполняет корутины и трансформации.
- **Data слой**: сущности Room, DAO и база `TalaDatabase`.

## Навигация и экраны

- Навигация управляется вручную через `FragmentManager`; каждый тип карточки — отдельный фрагмент (`*_card_type`).
- Списки слов и коллекций отображаются через RecyclerView-адаптеры; добавление/редактирование карточек реализовано в `AddWordFragment`.
- В дальнейшем планируются дополнительные сценарии (фразы, правила) — для них следует повторять структуру «экран + ViewModel + репозиторий».

## Конфигурация и зависимости

- Глобальные настройки повторения (`ReviewSettings`) задают интервалы и используются в расчётах SM-2.
- Все сетевые клиенты и базы инициализируются через DI-провайдеры (планируется внедрение Hilt/Koin — уточнить при расширении).

## Что менять при доработке

- При добавлении нового модуля определяй его место в слоях (UI/ViewModel/Repository/Data) и обновляй соответствующие разделы.
- Обновляй список ключевых сущностей, если появляются новые таблицы или API.
- Вноси изменения в навигацию `MainActivity`, когда добавляются новые фрагменты, и отражай это в документации.

