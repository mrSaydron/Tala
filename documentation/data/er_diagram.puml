@startuml
' ER-диаграмма Tala (PlantUML)

entity dictionary {
  *id : INT
  --
  word : STRING
  translation : STRING
  part_of_speech : STRING
  ipa : STRING
  hint : STRING
  image_path : STRING
  base_word_id : INT
  frequency : DOUBLE
  level : STRING
  tags : STRING
}

entity dictionary_collections {
  *id : INT
  --
  name : STRING
  description : STRING
}

entity dictionary_collection_entries {
  *collection_id : INT
  *dictionary_id : INT
}

entity card {
  *id : INT
  --
  common_id : STRING
  next_review_date : LONG
  collection_id : INT
  info : STRING
  card_type : STRING
  interval_minutes : INT
  ef : DOUBLE
  status : STRING
}

entity collections {
  *id : INT
  --
  name : STRING
}

entity lessons {
  *id : INT
  --
  name : STRING
  full_name : STRING
  collection_id : INT
}

entity lesson_card_types {
  *collection_id : INT
  *card_type : STRING
  --
  condition_on_card_type : STRING
  condition_on_value : STRING
  condition_off_card_type : STRING
  condition_off_value : STRING
}

entity lesson_progress {
  *id : INT
  --
  lesson_id : INT
  card_type : STRING
  dictionary_id : INT
  next_review_date : LONG
  interval_minutes : LONG
  ef : DOUBLE
  status : STRING
  info : STRING
}

entity card_history {
  *id : INT
  --
  lesson_id : INT
  card_type : STRING
  dictionary_id : INT
  quality : INT
  date : LONG
}

dictionary ||--o{ dictionary : "base_word_id (самоссылка)"
dictionary ||--o{ dictionary_collection_entries : "слова в коллекциях"
dictionary_collections ||--o{ dictionary_collection_entries : "подборки → слова"
dictionary_collections ||--o{ lessons : "уроки"
dictionary_collections ||--o{ lesson_card_types : "доступные типы карточек"
lessons ||--o{ lesson_progress : "прогресс по уроку"
dictionary ||--o{ lesson_progress : "словарная привязка (nullable)"
collections ||--o{ card : "карточки коллекции"
lessons ||--o{ card_history : "история ответов по уроку"
dictionary ||--o{ card_history : "словарная привязка к истории"
@enduml